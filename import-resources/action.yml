# üìÑ import-resources.yml
# Action: Condicionalmente importa recursos AWS para o Terraform
# Objetivo: Verifica se recurso j√° existe e, se sim, importa via Terraform, sen√£o cria novo
name: Import existing AWS resources
description: "Importa condicionalmente recursos AWS j√° existentes para o Terraform state."

inputs:
  aws_access_key_id:
    description: AWS Access Key ID
    required: true
  aws_secret_access_key:
    description: AWS Secret Access Key
    required: true
  aws_region:
    description: Regi√£o da AWS
    required: true
  project_name:
    description: Nome do projeto
    required: true
  environment:
    description: "Nome do ambiente (ex: dev, prod)"
    required: true
  terraform_path:
    description: Caminho para o diret√≥rio com os arquivos Terraform e script import.sh (default terraform)
    required: false
    default: terraform

runs:
  using: composite
  steps:
    # -------------------------------
    # üîÑ IMPORT EXISTING RESOURCES
    # -------------------------------   
    # üì§ Verifica a exist√™ncia e realiza a chamada para o script de imports
    - name: Importar recursos existentes
      shell: bash
      run: |
        set -e
      
        if [ ! -f "${GITHUB_ACTION_PATH}/scripts/import.sh" ]; then
          echo "‚ùå Script import.sh n√£o encontrado."
          exit 1
        fi
        bash "${GITHUB_ACTION_PATH}/scripts/import.sh"

        set +e
      env:
        AWS_ACCESS_KEY_ID: ${{ inputs.aws_access_key_id }}
        AWS_SECRET_ACCESS_KEY: ${{ inputs.aws_secret_access_key }}
        AWS_REGION: ${{ inputs.aws_region }}
        PROJECT_NAME: ${{ inputs.project_name }}
        ENVIRONMENT: ${{ inputs.environment }}
