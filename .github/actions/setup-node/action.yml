name: Setup Node and Environment
description: "Configura o Node.js e define variÃ¡veis globais de ambiente"

inputs:
  node_version:
    description: "VersÃ£o do Node.js a ser usada"
    required: false
    default: '20'
  working_directory:
    description: "DiretÃ³rio onde os comandos serÃ£o executados (default: .)"
    required: false
    default: '.'

runs:
  using: composite
  steps:
    - name: Setup Node.js ${{ inputs.node_version }}
      uses: actions/setup-node@v4
      with:
        node-version: ${{ inputs.node_version }}

    - name: Setup Environment Variables
      shell: bash
      working-directory: ${{ inputs.working_directory }}
      run: |
        echo "PROJECT_NAME=${GITHUB_REPOSITORY#*/}" >> $GITHUB_ENV

        if [[ "${{ github.base_ref }}" == "main" ]]; then
          echo "ENVIRONMENT=prod" >> $GITHUB_ENV
        elif [[ "${{ github.base_ref }}" == "develop" ]]; then
          echo "ENVIRONMENT=dev" >> $GITHUB_ENV
        else
          echo "ENVIRONMENT=preview" >> $GITHUB_ENV
        fi

        echo "ðŸ“¦ Ambiente configurado: PROJECT_NAME=${GITHUB_REPOSITORY#*/}, ENVIRONMENT=$ENVIRONMENT"
